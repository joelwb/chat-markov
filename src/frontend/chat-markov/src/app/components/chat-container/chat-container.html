@if(selectors.selectedChat()) {
<main class="chat" #chatScroll (scroll)="onContainerScroll()" [class.show-top-border]="!isAtTop()">
    @for (msg of messages(); track msg.id; let last = $last) {
        <div class="contained msg">
            @if (msg.sendBy == sendedBy.USER) {
                @if (msg.filename) {
                    <div class="file-selected">
                        <div class="progress-container">
                            @if(selectors.isTrainingSelectedChat() && last) {
                                @if (selectors.trainingProgress() != null) {
                                    <svg width="20" height="20" viewBox="0 0 120 120" class="h-6 w-6"><circle class="origin-[50%_50%] -rotate-90 stroke-gray-400" stroke-width="10" fill="transparent" r="55" cx="60" cy="60"></circle><circle class="origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]" stroke="currentColor" stroke-width="10" [attr.stroke-dashoffset]="progressConvertedToDashoffset()" stroke-dasharray="345.575" fill="transparent" r="55" cx="60" cy="60" style="stroke-linecap: round;"></circle></svg>
                                } 
                                @else {
                                    <svg width="20" height="20" viewBox="0 0 120 120" class="h-6 w-6 undefined-loading"><circle class="origin-[50%_50%] -rotate-90 stroke-gray-400" stroke-width="10" fill="transparent" r="55" cx="60" cy="60"></circle><circle class="origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]" stroke="currentColor" stroke-width="10" [attr.stroke-dashoffset]="259.18125" stroke-dasharray="345.575" fill="transparent" r="55" cx="60" cy="60" style="stroke-linecap: round;"></circle></svg>
                                }
                            } @else {
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none" class="h-10 w-10 shrink-0" width="36" height="36"><rect width="36" height="36" rx="6" fill="#FF5588"></rect><path d="M19.6663 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V14.6666L19.6663 9.66663Z" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M19.667 9.66663V14.6666H24.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M21.3337 18.8334H14.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M21.3337 22.1666H14.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.3337 15.5H15.5003H14.667" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                            }
                        </div>
                        <div class="file-data">
                            <label class="file-name">{{msg.filename}}</label>
                            <label class="file-type">Documento</label>
                        </div>
                    </div>
                }
                <pre class="user-msg">{{msg.value!.trim()}}</pre>
            }
            @else {
                <pre>{{msg.value}}</pre>
            }
        </div>
    }

    @if (selectors.isTrainingSelectedChat()) {
        <div class="contained">
            <p>Treinando...</p>
        </div>
    }

    <div #scrollToMe class="contained"></div>
</main>
} @else {
    <div class="empty-state" [class.creating-new-chat]="creatingNewChat()">
        <h1>Dê um nome para seu chat e anexe um arquivo.</h1>
        <p>O ChatMarkov é capaz de tentar adivinhar o próximo token baseado nos N tokens anteriores — quanto maior o N, maior o modelo e pior a performance do treino (exponencialmente)</p>
    </div>
}

<footer>
    <button (click)="scrollToBottom()" class="scroll-down" [class.visible]="!isAtBottom() && selectors.selectedChat()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon text-token-text-primary"><path d="M9.33468 3.33333C9.33468 2.96617 9.6326 2.66847 9.99972 2.66829C10.367 2.66829 10.6648 2.96606 10.6648 3.33333V15.0609L15.363 10.3626L15.4675 10.2777C15.7255 10.1074 16.0762 10.1357 16.3034 10.3626C16.5631 10.6223 16.5631 11.0443 16.3034 11.304L10.4704 17.137C10.2108 17.3967 9.7897 17.3966 9.52999 17.137L3.69601 11.304L3.61105 11.1995C3.44054 10.9414 3.46874 10.5899 3.69601 10.3626C3.92328 10.1354 4.27479 10.1072 4.53292 10.2777L4.63741 10.3626L9.33468 15.0599V3.33333Z"></path></svg>
    </button>
    <div class="contained" [class.gradient]="selectors.selectedChat()">
        <app-prompt-area (send)="send($event)"/>
    </div>
</footer>